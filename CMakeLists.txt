PROJECT (MOONSHINE C)

CMAKE_MINIMUM_REQUIRED(VERSION 2.4.6)

SET(SRC "${MOONSHINE_SOURCE_DIR}")
SET(BIN "${MOONSHINE_BINARY_DIR}") 
SET(CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS 1)
SET(CMAKE_MODULE_PATH "${SRC}/cmake")
INCLUDE(FindPkgConfig)

PKG_CHECK_MODULES(GLIB REQUIRED glib-2.0 gthread-2.0)
PKG_SEARCH_MODULE(LUA REQUIRED lua lua5.1)
FIND_PACKAGE(SLANG REQUIRED)

INCLUDE_DIRECTORIES(BEFORE
	${SLANG_INCLUDE_DIR}
	${LUA_INCLUDE_DIRS}
	${GLIB_INCLUDE_DIRS}
	${GNET_INCLUDE_DIRS}
	${GTHREAD_INCLUDE_DIRS}
	${SRC})

ADD_DEFINITIONS("-std=gnu99 -Wall -Winline")
ADD_DEFINITIONS("${GLIB_CFLAGS_OTHER} ${GNET_CFLAGS_OTHER} ${LUA_CFLAGS_OTHER}")

SET(VER "p2+")
SET(MOONSHINE_VERSION ${VER})
SET(MOONSHINE_RUNTIME "${CMAKE_INSTALL_PREFIX}/share/moonshine")
SET(MOONSHINE_MODULES "${CMAKE_INSTALL_PREFIX}/lib/moonshine")

INCLUDE_DIRECTORIES(${MOONSHINE_BINARY_DIR})

CONFIGURE_FILE(config.h.in
	${MOONSHINE_BINARY_DIR}/moonshine/config.h
	@ONLY IMMEDIATE)

ADD_SUBDIRECTORY(core)
ADD_SUBDIRECTORY(modules ${PROJECT_BINARY_DIR}/modules/moonshine)
#ADD_SUBDIRECTORY(runtime/moonshine)

INSTALL(DIRECTORY runtime/ DESTINATION ${MOONSHINE_RUNTIME})
